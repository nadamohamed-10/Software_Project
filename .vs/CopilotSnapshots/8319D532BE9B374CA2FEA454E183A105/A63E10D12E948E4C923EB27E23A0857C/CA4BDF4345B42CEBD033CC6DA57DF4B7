using CLINICSYSTEM.Constants;
using CLINICSYSTEM.Data.DTOs;
using FluentValidation;

namespace CLINICSYSTEM.Validators;

/// <summary>
/// Validator for creating consultations
/// </summary>
public class CreateConsultationDtoValidator : AbstractValidator<CreateConsultationDto>
{
    public CreateConsultationDtoValidator()
    {
        RuleFor(x => x.AppointmentId)
            .NotEmpty()
            .GreaterThan(0).WithMessage(ValidationMessages.IdInvalid);

        RuleFor(x => x.Symptoms)
            .NotEmpty().WithMessage(ValidationMessages.SymptomsRequired)
            .Length(10, 2000).WithMessage(ValidationMessages.SymptomsLength);

        RuleFor(x => x.Diagnosis)
            .NotEmpty().WithMessage(ValidationMessages.DiagnosisRequired)
            .Length(10, 2000).WithMessage(ValidationMessages.DiagnosisLength);

        RuleFor(x => x.Notes)
            .MaximumLength(2000).WithMessage(ValidationMessages.NotesLength);

        RuleFor(x => x.FollowUpDate)
            .GreaterThan(DateTime.Now).When(x => x.FollowUpDate.HasValue)
            .WithMessage("Follow-up date must be in the future.");
    }
}

/// <summary>
/// Validator for updating consultations
/// </summary>
public class UpdateConsultationDtoValidator : AbstractValidator<UpdateConsultationDto>
{
    public UpdateConsultationDtoValidator()
    {
        RuleFor(x => x.Symptoms)
            .Length(10, 2000).When(x => !string.IsNullOrEmpty(x.Symptoms))
            .WithMessage(ValidationMessages.SymptomsLength);

        RuleFor(x => x.Diagnosis)
            .Length(10, 2000).When(x => !string.IsNullOrEmpty(x.Diagnosis))
            .WithMessage(ValidationMessages.DiagnosisLength);

        RuleFor(x => x.Notes)
            .MaximumLength(2000).WithMessage(ValidationMessages.NotesLength);

        RuleFor(x => x.FollowUpDate)
            .GreaterThan(DateTime.Now).When(x => x.FollowUpDate.HasValue)
            .WithMessage("Follow-up date must be in the future.");
    }
}
